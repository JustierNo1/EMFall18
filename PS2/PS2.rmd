---
title: "Problem Set 2 Empirical Methods"
date: "05.11.2018"
output: 
  html_document: 
  latex engine: xelatex
author: Patrick Glettig (13-252-143), Carmine Ragone (14-995-021)
---

```{r global options, include=FALSE}
library(knitr)
library(Cairo)
library(extrafont)
library(latex2exp)
library(readstata13)
library(Hmisc)
library(lmtest)
library(stargazer)
library(kableExtra)
library(ggplot2)
library(data.table)
library(tidyr)

knitr::opts_chunk$set(echo = TRUE, fig.show = "hold", collapse = TRUE, tidy.opts=list(width.cutoff=60),tidy=TRUE,
                      fig.height = 2, fig.width = 4)

sysinf <- Sys.info()
if(sysinf['sysname'] == "Windows"){
  extrafont::loadfonts(device="win")
  #opts_chunk$set(dev = "CairoPDF")
}
```


# Paper and Pencil Questions

### 2. The gender wage gap

*Suppose you want to test whether in your country women are discriminated against  relative to men in terms of wages. You decide that you want to test whether men and women have different salaries. Suppose you are able to gather data on the whole working population in your country. For each individual you have the following information.*

* *monthly wage*
* *gender*
* *years of education*

*(a) Suppose years of education have the same effect on wages for both men and women. Propose a simple regression model to test your hypothesis.*
$$ Wage_i = \alpha + \beta_1Edu_i + \beta_2Male_i + \epsilon_i$$
Where *Male* is a dummy variable which takes value 0 for females and 1 for male observations. 

*(b) Provide a graphical representation of the conditional expectation function (i.e. the part of wages that we can explain with our covariates) and show if and how it differs for men and women.*

$$E(Wage_i|Edu_i,Male_i)=\begin{cases}
    \alpha + \beta_1Edu_i + \epsilon_i,& \text{if } Male_i = 0\\
     \alpha  + \beta_1Edu_i + \beta_2 + \epsilon_i,& \text{if } Male_i = 1
\end{cases}$$

*(c) In retrospect, you decide that years of education might have a different marginal effect on men compared to women. How would you modify your regression model to account for this differential effect?*

$$ Wage_i = \alpha + \beta_1Edu_i + \beta_2Male_i + \beta_3Edu_i \times Male_i + \epsilon_i $$

*(d) Provide a graphical representation of the conditional expectation function (i.e. the part of wages that we can explain with our covariates) and show if and how it differs for men and women*
$$E(Wage_i|Edu_i,Male_i)=\begin{cases}
    \alpha + \beta_1Edu_i + \epsilon_i,& \text{if } Male_i = 0\\
     \alpha  + \beta_1Edu_i + \beta_2 + \beta_3Edu_i + \epsilon_i,& \text{if } Male_i = 1
\end{cases}$$

## 2. Empirical Application
**1. The Gender Wage Gap.** *In this exercise we will try to explore some discrimination theories analyzing a subsample from the US CPS2015. Many politicians, institutional observers, and researchers still claim today the existence of discrimination against female workers in the labor market. They base their claims looking at the gender wage gap, i.e. the difference between men’s and women’s wages. As many other things in
economics, this wage gap can be generated both from the demand side (employers who discriminate against women) and from the supply side (women having different skills or preferences for specific jobs or for entering the labor market at all). In this exercise we will try to learn more about the gender wage gap, while testing you on your econometric toolkit. For this question, assume that Assumption 2 (Mean-zero Error) holds so that you can make causal statements in your answers.*

*Download the dataset sampleUScens2015.csv from OLAT and import it into Stata or R. The dataset includes prime age individuals (i.e. *age $\in [25; 54]$) *active in the labor market (i.e. either employed or looking for job), and working in the private sector. There are seven relevant variables:*

* *age*, the age of the individual in 2015
* *education*, years of completed education
* *incwage*, income from wages in 2015 in USD
* *female*, dummy for female
* *childrenly*, dummy if had a children in the last year
* *degfield*, field of degree
* *occupation*, sector of occupation

At first we need to load the data in order to start our analysis:
```{r}
USCPS <- fread('sampleUScens2015.CSV')
head(USCPS) # Check the format
dim(USCPS) #Check length
summary(USCPS) #Explore the data
```
The summary tells us that there are some NAs in $educ$, we want to explore this:
```{r}
head(USCPS[rowSums(is.na(USCPS)) > 0,])
```
The other columns seem fine, we could still keep these observations in the dataset. However, the data quality on these 45 observations seems poor anyway as $firmsector, occupation$ and $degfield$ are in most cases "other", which is not really informative. Also, 45 observations are just a tiny fraction of the overall sample. As it is easier to work with a complete dataframe, we drop the observations containing NAs:
```{r results='hide'}
USCPS <- USCPS %>% drop_na()
```

(a) *Generate a new variable called* $wage = incwage/1000$. *Also, generate* $lw$ *taking the log of wage. Generate a dummy named university which is equal to 1 if* $education \geq 16$. *First regress wage on education, then regress wage on education and the university dummy. How does the coefficient on education change? How do you interpret it in both specifications?*

**Create the variables**
```{r}
USCPS$wage <- USCPS$incwage/1000 #create wage
USCPS$lw <- log(USCPS$wage) #create log wage
USCPS$university <- as.numeric(USCPS$educ >= 16) #create university dummy

head(USCPS[university==1,])#and we quickly check if the dummy was created correctly
```

**Run the regressions**
```{r results='asis'}
model.1 <- lm(wage ~ educ, data = USCPS)
model.2 <- lm(wage ~ educ + university, data = USCPS)
#Currently this stargazer produces an error, I could not fix it now. If you have time it would be great if you could look into this.
# stargazer(model.1, model.2, title="Regression Results",
#  align=TRUE, dep.var.labels=c("Wage"),
#  covariate.labels=c("Education","University x Education"),
#  omit.stat=c("all"), no.space=TRUE, ci = TRUE)

#Hence you can use this to look at the results
summary(model.1)
summary(model.2)
```